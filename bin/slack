#!/usr/bin/env coffee

Slack = require '..'

token = process.argv[2]
if not token
  console.error "Token is required"
  process.exit 1
else
  shutdown = false
  slack = new Slack token

  slack.on 'error', (error) ->
    console.error 'Error: '+error
    process.exit 1

  slack.on 'open', ->
    console.log 'Connected!'

  slack.on 'close', ->
    console.warn 'Disconnected!'
    if not shutdown then setTimeout slack.login(), 5000

  process.on 'SIGINT', ->
    shutdown = true
    slack.disconnect()

  console.log 'Connecting...'
  slack.login()
